<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manga Viewer</title>
    <link rel="stylesheet" href="manga.css">
    <link rel="stylesheet" href="homePage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
         .save-icon {
    cursor: pointer;
    color: #ff4d4d;
    font-size: 22px;
    transition: transform 0.2s;
}

.save-icon:hover {
    transform: scale(1.2);
}

.movie-card {
    position: relative;
}

.save-icon-container {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
}
    </style>

</head>

<body class="body">
    <nav class="Nav">
        <h2 onclick="navigateTo('homePage.html')">Manga</h2>
        <ul class="ul link-offset">
            <li onclick="navigateTo('homePage.html')">Home</li>
            <li onclick="navigateTo('latest.html')">Latest</li>
            <li onclick="navigateTo('Review.html')">Review</li>
            <li onclick="navigateTo('contact.php')">Contact</li>
            <li onclick="navigateTo('Profile.php')">Profile</li>
        </ul>
        <button class="button1" onclick="logout()">Sign up</button>
    </nav>

    <div class="movie-container" id="results"></div>

    <script>
        async function fetchMangas() {
            try {
                const response = await fetch('https://mangaverse-api.p.rapidapi.com/manga/fetch?page=1&genres=Harem%2CFantasy&nsfw=true&type=all', {
                    method: 'GET',
                    headers: {
                        'x-rapidapi-host': 'mangaverse-api.p.rapidapi.com',
                        'x-rapidapi-key': 'your_api_here'
                    }
                });

                const data = await response.json();
                console.log('Fetched Data:', data);

                const mangaList = data.data || [];

                if (mangaList.length === 0) {
                    document.getElementById('results').innerHTML = 'No results found.';
                } else {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = '';

                    // Loop through the manga list and create a card for each one
                    mangaList.forEach(manga => {
                        const card = document.createElement('div');
                        card.className = 'movie-card';
                        const mangaData = encodeURIComponent(JSON.stringify(manga));
                        card.innerHTML = `
                            <div class="save-icon-container">
                                <i class="fas fa-heart save-icon" title="Save to profile" onclick='saveManga("${mangaData}")'></i>
                            </div>
                            <div class="content-card">
                                <div class="coverImage">
                                    <img src="${manga.thumb || 'https://via.placeholder.com/300x450?text=No+Image'}" alt="${manga.title}" />
                                </div>
                                <div class="content">
                                    <h1>${manga.title}</h1>
                                    <p><strong>Genres:</strong> ${manga.genres.join(', ')}</p>
                                    <p><strong>Status:</strong> ${manga.status || 'Unknown'}</p>
                                   <p><strong>Chapters:</strong>${manga.total_chapter || '0'}</p>
                                    <button class="primary-btn"><i class="fas fa-play"></i> VIEW MANGA</button>
                                </div>
                            </div>
                        `;
                        resultsDiv.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Error fetching manga:', error);
                document.getElementById('results').innerHTML = 'Error fetching data.';
            }
        }

        window.onload = fetchMangas;


        function saveManga(encodedManga) {
            const manga = JSON.parse(decodeURIComponent(encodedManga));
            let saved = JSON.parse(localStorage.getItem('savedManga')) || [];

            if (!saved.some(m => m.id === manga.id)) {
                saved.push(manga);
                localStorage.setItem('savedManga', JSON.stringify(saved));
                alert(`Saved "${manga.title}" to profile.`);
            } else {
                alert(`"${manga.title}" is already saved.`);
            }
        }

        function unsaveManga(encodedManga) {
        const manga = JSON.parse(decodeURIComponent(encodedManga));
        let saved = JSON.parse(localStorage.getItem('savedManga')) || [];

        const index = saved.findIndex(m => m.id === manga.id);
        if (index !== -1) {
            saved.splice(index, 1);
            localStorage.setItem('savedManga', JSON.stringify(saved));
            alert(`Removed "${manga.title}" from saved mangas.`);
        } else {
            alert(`"${manga.title}" was not found in saved mangas.`);
    }
}

        function logout() {
            alert("Logging out...");
        }
    </script>

    <script src="homePage.js"></script>
</body>


</html>
